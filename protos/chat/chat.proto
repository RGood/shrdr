syntax = "proto3";

package chat;

option go_package = "github.com/RGood/shrdr/common/pkg/generated/chat;chat";

import "identity/identity.proto";

message JoinRoom {
    string room_id = 1;
}

message Message {
    oneof target {
        string room_id = 1;
        string user_id = 2;
    }
    string content = 3;
}

message LeaveRoom {
    string room_id = 1;
}

message Send {
    oneof action {
        JoinRoom join = 1;
        LeaveRoom leave = 2;
        Message message = 3;
    }
}

message ChatMessage {
    oneof target {
        string room_id = 1;
        string user_id = 2;
    }
    identity.User author = 3;
    string content = 4;
    int64 timestamp = 5;
}

service Chat {
    rpc Connect(stream Send) returns (stream ChatMessage);
}
